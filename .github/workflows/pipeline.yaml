name: CI Pipeline

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        id: install_step
        run: npm install --legacy-peer-deps
        continue-on-error: true # This prevents the pipeline from stopping immediately

      - name: Print npm debug log on failure
        if: steps.install_step.outcome == 'failure'
        run: |
          ls -R /home/runner/.npm/_logs/
          cat /home/runner/.npm/_logs/*.log
          exit 1 # Now we manually fail the job so you know it didn't work